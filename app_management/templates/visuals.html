<!DOCTYPE html>
<html >
{% load static %}
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon"
        href="{% static 'app_management/images/mcdonalds-clip-art-png-31.png' %}"+href="{% static 'app_management/images/logo.jpeg' %}"
        type="image/png" />
    <title>|Retail Audit Reporting</title>
    <link rel="stylesheet" type="text/css" href="{% static 'css/controls.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'system_management/css/user_engagement.css' %}">
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/raphael"></script>
    <script src="https://cdn.jsdelivr.net/npm/justgage/justgage.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <script src="https://code.highcharts.com/stock/highstock.js"></script>
    <script src="https://code.highcharts.com/stock/highcharts-more.js"></script>
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/modules/data.js"></script>
    <script src="https://code.highcharts.com/modules/drilldown.js"></script>
    <script src="https://code.highcharts.com/modules/exporting.js"></script>
    <script src="https://code.highcharts.com/modules/export-data.js"></script>
    <script src="https://code.highcharts.com/modules/accessibility.js"></script>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.14.0-beta2/css/bootstrap-select.min.css" />
    <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
    <script src="https://code.highcharts.com/maps/highmaps.js"></script>
    <script src="https://code.highcharts.com/mapdata/index.js"></script>
    <script src="https://code.highcharts.com/modules/accessibility.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.js"></script>
    <script src="https://www.highcharts.com/samples/static/jquery.combobox.js"></script>
    <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/base/jquery-ui.css" rel="stylesheet">
    <link href="https://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
    <!-- Add these links to your HTML -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css">
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>

   
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            background-color: white;
        }

        header {
            background-color: white;
            color: #0a0606;
            padding: 1%;
            text-align: center;
            position: relative;
        }

        header img {
            position: absolute;
            top: 1%;
            left: 1%;
            max-width: 5%; /* Adjust the size as needed */
            height: auto;
        }

        nav a {
            display: inline-block;
            color: black;
            text-decoration: none;
            position: fixed;
            top: 1%; /* Adjust the top margin */
            right: 0;
            margin: 0 2%; /* Adjust the percentage margin */
            padding: 1% 2%; /* Adjust the percentage padding to control button size */
            background-color: #FFC72C; /* McDonald's red color */
            font-family: 'Speedee', sans-serif;
            border-radius: 5px;
            transition: background-color 0.3s ease;
        }

        nav a:hover {
            background-color: #FFC72C; /* Lighter shade for hover effect */
        }

        

        .dashboard-content {
            background-color: white;
            border: 2px solid #FFC72C;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            text-align: center;
            margin-bottom: 20px;
        }

        h1 {
    font-family: 'YourMcDonaldsFont', sans-serif; /* Replace 'YourMcDonaldsFont' with the actual font name */
    /* Add any additional styles as needed */
}
h2 {
    font-family: 'YourMcDonaldsFont', sans-serif; /* Replace 'YourMcDonaldsFont' with the actual font name */
    /* Add any additional styles as needed */
}

select {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-right: 20px;
        }

        .form-control.textbox {
    width: 100%;
}

.form-control.textbox.topMargin {
    margin-top: 1vw;
}

.mcdonalds-yellow {
    background-color: #FFD200; /* McDonald's yellow color */
    color: black; /* Text color */
    /* Add any additional styles as needed */
}
/*.container {
    width: calc(100% - 600px); 
        }*/


        h1 {
    font-size: 30px;
    margin: 0 auto; /* Center horizontally */
    text-align: center; /* Center text inside the element */
}

        .container {
            display: none;
        }
        .container.active {
            display: block;
        }
        @import url('https://fonts.googleapis.com/css2?family=Speedee&display=swap');

        .green-text::before {
    content: '\2713'; /* Unicode character for checkmark */
    margin-right: 5px; /* Adjust as needed */
}
.red-text::before {
    content: 'X';
    margin-right: 5px; /* Adjust as needed */
}
.center {
    position: fixed;
    top: 15%;
    left: 48%;
    transform: translate(-50%, -50%);
    display: none;
}
#disclaimermccafe {
    display: none; /* Initially hidden */
    text-align: center;
    color: red;
    border: 2px solid red;
    padding: 10px;
}

#disclaimerdrive {
    display: none; /* Initially hidden */
    text-align: center;
    color: red;
    border: 2px solid red;
    padding: 10px;
}

/* Modal styles */
.modal {
    display: none; /* Hidden by default */
    position: fixed; /* Stay in place */
    z-index: 1; /* Sit on top */
    padding-top: 50px; /* Location of the box */
    left: 0;
    top: 0;
    width: 100%; /* Full width */
    height: 100%; /* Full height */
    overflow: auto; /* Enable scroll if needed */
    background-color: rgb(0,0,0); /* Fallback color */
    background-color: rgba(0,0,0,0.9); /* Black w/ opacity */
}

/* Modal Content (image) */
.modal-content {
    margin: auto;
    display: block;
    width: 80%;
    max-width: 700px;
}

/* Close button */
.close {
    position: absolute;
    top: 15px;
    right: 35px;
    color: #f1f1f1;
    font-size: 40px;
    font-weight: bold;
    transition: 0.3s;
}

.close:hover,
.close:focus {
    color: #bbb;
    text-decoration: none;
    cursor: pointer;
}

    </style>
</head>

<body>

    <header>
        <div style="display: flex; align-items: center;">
            <img src="{% static 'app_management/images/mcdonalds-clip-art-png-31.png' %}" alt="Logo" style="margin-left: 5%;">
            <img src="{% static 'app_management/images/logo.jpeg' %}" alt="Logo" style="margin-top: 1%;">
            
        </div>
        <form method="post" action="{% url 'home' %}">
            {% csrf_token %}
            <button class="btn" style="text-align: center; background-color: #FFD200; font-family: 'Speedee', sans-serif;" type="submit">Landing Page</button>
        </form>
        
    </header>
    <nav>
        <a class="btn" style="text-align: center; background-color: #FFD200; font-family: 'Speedee', sans-serif;" href="{% url 'logout' %}">Logout</a>
    </nav>
    <div id="visuals" class="container active" style="max-width: 100%; padding: 0; margin: 0;">
        <h1 style="font-weight: bold;font-size: 200%;font-family: 'Speedee', sans-serif;">Retail Audit Reporting Visualisations</h1>
        <hr>
        
        
        
        <div class="row">
            <!--<div class="col-sm-2">
                <label for="filter1" style="font-weight: bold;font-family: 'Speedee', sans-serif;">From:</label>
                <input type="text" id="fromDate" class="form-control datepicker">
            </div>
            <div class="col-sm-2">
                <label for="filter1" style="font-weight: bold;font-family: 'Speedee', sans-serif;">To:</label>
                <input type="text" id="toDate" class="form-control datepicker">
            </div>-->
            
          <!-- <div class="col-sm-3">
                <label for="filter1" style="font-weight: bold;font-family: 'Speedee', sans-serif;">Select Province:</label>
                <select id="filterprovincestore" class="form-control drop-down-list">
                     <option value="all">All</option>
                    {% for province in region_name %}
                    <option value="{{ province.region}}">{{ province.region }}</option>
                     {% endfor %}
                </select>
            </div>-->
         <!--<div class="col-sm-3">
                <label for="filter2" style="font-weight: bold;font-family: 'Speedee', sans-serif;">Select Own/Franchise:</label>
                <select id="filterownerfranchise" class="form-control drop-down-list">
                  <option value="all">All</option>
                    {% for own_franchise in franchise_mcopco %}
                        <option value="{{ own_franchise.portfolio_type }}">{{ own_franchise.portfolio_type }}</option>
                    {% endfor %} 
                </select>
            </div>-->  
            <div class="col-sm-3">
                <label for="filter1" style="font-weight: bold;font-family: 'Speedee', sans-serif;">Select Month:</label>
                <select id="month" class="form-control drop-down-list" onchange="filterProvinces()">
                    <option value=""></option>
                    <option value="March_2025">February 2024</option>
                    <option value="February_2025">April 2024</option>
                    <option value="March_2025">May 2024</option>
                </select>
            </div>
            <div class="col-sm-3">
                <label for="filter1" style="font-weight: bold;font-family: 'Speedee', sans-serif;">Select Province:</label>
                <select id="province_store" class="form-control" onchange="submitForm()">
                </select>
            </div>
            
            
        <div class="col-sm-3">
            <label for="filter2" style="font-weight: bold;font-family: 'Speedee', sans-serif;">Select Store:</label>
            <select id="filterstore" class="form-control drop-down-list">
            </select>
        </div>
          
            
           <!-- <button id="filterbutton" class="btn mcdonalds-yellow" style="height: 40px; margin-top: 30px;">Filter</button>-->
        </div>
        <hr> 
        <div class="row">
           <!-- <div class="col-lg-12">
                <div class="card-body shadow-lg">
                    <div class="card-header py-2" style="text-align: center; background-color:#FFD200;font-weight: bold;font-family: 'Speedee', sans-serif;">
                        
                    </div>
                    <div id="container-visualizations" style="width: 100%;height: 90%;"></div>
                </div>
                
            </div>-->
            <div class="col-lg-6">
                <div class="card-body shadow-lg">
                    <div class="card-header py-2" style="text-align: center; background-color:#FFD200;font-weight: bold;font-family: 'Speedee', sans-serif;">
                        Overall Score
                    </div>
                    <div id="container-compare" style="width: 100%;height: 90%;"></div>
                </div>        
            </div>
            <div class="col-lg-6">
                <div class="card-body shadow-lg">
                    <div class="card-header py-2" style="text-align: center; background-color:#FFD200;font-weight: bold;font-family: 'Speedee', sans-serif;">
                        Actuals Vs Targets
                    </div>
                    <div id="container-compare-bar" style="width: 100%;height: 90%;"></div>
                </div>        
            </div>
        </div>
        <div class="row">
            <div class="col-lg-2" >
                <div class="card-body shadow-lg" style="height: 100%;">
                    <div class="card-header py-2" style="text-align: center; background-color:#FFD200;font-weight: bold;font-family: 'Speedee', sans-serif;">
                        Upon Entrance(outside)
                    </div>
                    <div id="gauge-container-outside-store-level" style="width: 100%; height: 11%;margin: auto;display: none;"></div>

                    <div id="textContainer">
                        <hr>
                        <p id="displayT"></p>
                        <p id="displayTname"></p>
                        <hr>
                        <p id="displayText3"></p>
                        <hr>
                        <p id="displayText8"></p>
                        <button id="showImageBtn" style="display: none;">Show Image</button>

                        <!-- Modal for displaying the image -->
                        <div id="imageModal" class="modal">
                            <span class="close">&times;</span>
                            <img class="modal-content" id="img01">
                        </div>
                    </div>

                    
                </div>
            </div>
            <div class="col-lg-2">
                <div class="card-body shadow-lg" style="height: 100%;">
                    <div class="card-header py-2" style="text-align: center; background-color:#FFD200;font-weight: bold;font-family: 'Speedee', sans-serif;">
                        Upon Entrance(In-store)
                    </div>
                    <div id="gauge-container-inside-store-level" style="width: 100%; height: 11%;margin: auto;"></div>
                    <div id="textContainer">
                        <p id="displayinside"></p>
                        <p id="displayinsidename"></p>
                        <hr>
                        <p id="displayTextinside"></p>
                        <hr>
                        <p id="displayTextinside10"></p>
                        <hr>
                        <p id="displayTextinside2"></p>
                        <hr>
                        <p id="displayTextinside12"></p>
                        <hr>
                        <p id="displayTextinside3"></p>
                        <p id="displayTextinside3Tvnumber"></p>
                        <p id="displayTextinside3Tvnumberfunctioning"></p>
                        <hr>
                        <p id="displayTextinside4"></p>
                        <hr>
                        <p id="displayTextinside9"></p>
                        <p id="displayTextinside8"></p>
                        <hr>
                        <p id="displayTextinside11"></p>
                        <hr>
                        <p id="displayTextinside5"></p>
                        <button id="showImageBtninside" style="display: none;">Show Image</button>

                        <!-- Modal for displaying the image -->
                        <div id="imageModalinside" class="modal">
                            <span class="close">&times;</span>
                            <img class="modal-content" id="img01inside">
                        </div>
                        <hr>
                        <p id="displayTextinside7"></p>
                        <p id="displayTextinside77"></p>
                        <hr>
                    </div>
                </div>
            </div>
            <div class="col-lg-2">
                <div class="card-body shadow-lg" style="height: 100%;">
                    <div class="card-header py-1" style="text-align: center; background-color:#FFD200;font-weight: bold;font-family: 'Speedee', sans-serif;">
                        Main Digital Menu board and Pricing
                    </div>
                    <div id="gauge-container-menu-store-level" style="width: 100%; height: 11%;margin: auto;"></div>
                    <div id="textContainer">
                        <p id="displaymenu"></p>
                        <p id="displaymenuname"></p>
                        <hr>
                        <p id="displayTextmenu"></p>
                        <p id="displayTextmenu1"></p>
                        <hr>
                        <p id="displayTdigital"></p>
                        <hr>
                        <p id="displayTextmenu2"></p>
                        <hr>
                        <p id="displayTextmenu3"></p>
                        <p id="displayTextmenu4"></p>
                        <hr>
                        <p id="displayTextmenu6"></p>
                        <p id="displayTextmenu5"></p>
                    </div>
                </div>
            </div>
                <div id="mccafedisplay" class="col-lg-2">
                    <div class="card-body shadow-lg" style="height: 100%;">
                        <div class="card-header py-2" style="text-align: center; background-color:#FFD200;font-weight: bold;font-family: 'Speedee', sans-serif;">
                            McCafé Main Menu
                        </div>
                        <div id="disclaimermccafe" style="display: none; text-align: center; color: red; border: 2px solid red; padding: 10px;">
                                No McCafé
                        </div>
                        <div id="nomccafedisplay">
                            <div id="gauge-container-mccafe-store-level" style="width: 100%; height: 11%;margin: auto;"></div>
                            <div id="textContainermenu">
                                <p id="displaymccafe"></p>
                                <p id="displaymccafename"></p>
                                <hr>
                                <p id="displayTextmccafe1"></p>
                                <hr>
                                <p id="displayTextmccafe5"></p>
                                <hr>
                                <p id="displayTextmccafe"></p>
                                <p id="displayTextmccafe3"></p>
                                <hr>
                                <p id="displayTextmccafe2"></p>
                                <p id="displayTextmccafe4"></p>
                            </div>
                        </div>
                        
                    </div>
                </div>
            <div id="drivedisplay" class="col-lg-2">
                <div class="card-body shadow-lg" style="height: 100%;">
                    <div id="driveThruHeader" class="card-header py-2" style="text-align: center; background-color:#FFD200;font-weight: bold;font-family: 'Speedee', sans-serif;">
                        Drive-thru
                    </div>
                    
                    <div id="disclaimerdrive" style="display: none; text-align: center; color: red; border: 2px solid red; padding: 10px;">
                        No Drive-thru
                    </div>
                    <div id="nodrivedisplay" style="display: none;">
                        <div id="gauge-container-drivethru-store-level" style="width: 100%; height: 11%;margin: auto;"></div>
                        <div id="textContainermenu">
                            <p id="displaydrivethru"></p>
                            <p id="displaydrivethruname"></p>
                            <hr>
                            <p id="displayTextdrivethru"></p>
                            <hr>
                            <p id="displayTextdrivethru5"></p>
                            <hr>
                            <p id="displayTextdrivethru1"></p>
                            <p id="displayTextdrivethru4"></p>
                            <hr>
                            <p id="displayTextdrivethru2"></p>
                            <p id="displayTextdrivethru3"></p>
                            <hr>
                            <p id="displayTextdrivethru33"></p>
                            <p id="displayTextdrivethru333"></p>
                            <hr>
                            <p id="displayTextdrivethru333advert"></p>
                            <p id="displayTextdrivethru333advertdesc"></p>
                            
                        </div>
                    </div>
                     
                </div>
            </div>
            <div class="col-lg-2">
                <div class="card-body shadow-lg" style="height: 100%;">
                    <div class="card-header py-2" style="text-align: center; background-color:#FFD200;font-weight: bold;font-family: 'Speedee', sans-serif;">
                        Delivery
                    </div>
                    <div id="gauge-container-delivery-store-level" style="width: 100%; height: 11%;margin: auto;"></div>
                    <div id="textContainermenu">
                        <p id="displaydelivery"></p>
                        <p id="displaydeliveryname"></p>
                        <hr>
                        <p id="displayTextdelivery"></p>
                        <hr>
                        <p id="displayTextdelivery1"></p>
                    </div>
                    
                </div>
            </div>
        </div>
         
    </div>
    
 
</body>
<footer style="background-color: #FFD200; text-align: center;  position: fixed; bottom: 0; width: 100%;font-family: 'Speedee', sans-serif;">
    <p style="color: black; margin: 0;">&copy; {% now "Y" %} Flowing Visual Patterns. All rights reserved.</p>
</footer> 
</html>
<!-- Include Highcharts library -->
  

<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/maps/modules/map.js"></script>
<script src="https://code.highcharts.com/mapdata/countries/za/za-all.geo.json"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.3.6/proj4.js"></script>
<script src="https://code.highcharts.com/maps/highmaps.js"></script>
<!-- Include Highcharts library and solid-gauge module -->
<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/highcharts-more.js"></script>
<script src="https://code.highcharts.com/modules/solid-gauge.js"></script>
<script>
function filterProvinces() {
    var selectedMonth = document.getElementById("month").value;
    var provinceDropdown = document.getElementById("province_store");

    // Reset province dropdown
    provinceDropdown.innerHTML = "<option value=''></option>";

    if (selectedMonth) {
        fetch('/get-provinces/?month=' + selectedMonth)
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                console.log("Received provinces data:", data);
                data.forEach(item => {
                    // Check if item is a string or object
                    var provinceName = typeof item === 'string' ? item : item.region;
                    var option = document.createElement("option");
                    option.value = provinceName;
                    option.text = provinceName;
                    provinceDropdown.appendChild(option);
                });
                console.log("Province dropdown updated successfully.");
            })
            .catch(error => console.error('Error fetching provinces:', error));
    }
}




function submitForm() {
    var selectedMonth = document.getElementById("month").value;
    var selectedProvince = document.getElementById("province_store").value;
    var storeDropdown = document.getElementById("filterstore");

    // Reset province dropdown
    storeDropdown.innerHTML = "<option value=''></option>";

    if (selectedMonth) {
        fetch('/get-stores/?month=' + selectedMonth + '&province=' + selectedProvince)
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                console.log("Received provinces data:", data);
                data.forEach(item => {
                    // Check if item is a string or object
                    var provinceName = typeof item === 'string' ? item : item.site_name;
                    var provinceName_id = typeof item === 'string' ? item : item.store_id;
                    var option = document.createElement("option");
                    option.value = provinceName_id;
                    option.text = provinceName;
                    storeDropdown.appendChild(option);
                });
                console.log("Province dropdown updated successfully.");
            })
            .catch(error => console.error('Error fetching provinces:', error));
    }
}


    $(document).ready(function () {
    // Get the current date
    var currentDate = new Date();

    // Set the default "From" date to the first day of the current month
    var defaultFromDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);

    // Use the current date as the default "To" date
    var defaultToDate = new Date();

    // Initialize date pickers
    $('#fromDate').datepicker({
        format: 'yyyy-mm-dd',
        autoclose: true,
        todayHighlight: true,
        startDate: defaultFromDate, // Set the default "From" date
    }).datepicker('setDate', defaultFromDate) // Set the initial date
    .on('changeDate', function (selected) {
        // Update the startDate of the "To" datepicker dynamically based on the selected date in "From" datepicker
        $('#toDate').datepicker('setStartDate', selected.date);
    });

    $('#toDate').datepicker({
        format: 'yyyy-mm-dd',
        autoclose: true,
        todayHighlight: true,
        startDate: defaultToDate, // Set the default "To" date
        beforeShowDay: function (date) {
            // Disable all dates after the month selected in the "fromDate" datepicker
            var fromDate = $('#fromDate').datepicker('getDate');
            return date >= fromDate && date <= defaultToDate ;
        }
    }).datepicker('setDate', defaultToDate); // Set the initial date
});

(async () => {
    // Load the map data for South Africa
     // Load the map data for South Africa
     const topology = await fetch(
        'https://code.highcharts.com/mapdata/countries/za/za-all.topo.json'
    ).then(response => response.json());

    const mapData = await fetch(
    'https://code.highcharts.com/mapdata/countries/za/za-all.topo.json'
).then(response => response.json());



//const storeData = await fetch('/get_map_data/').then(response => response.json());
//console.log('data')
//console.log(storeData)
/*const createMapStore = (data) => {
console.log(data)
const convertedStoreData = data.map(point => ({
    ...point,
    lat: parseFloat(point.latitude.replace(',', '.')),
    lon: parseFloat(point.longitude.replace(',', '.')),
}));

const chart = Highcharts.mapChart('container-visualizations', {

    title: {
        text: '',
    },

    legend: {
        align: 'left',
        layout: 'vertical',
        floating: true
    },

    accessibility: {
        point: {
            valueDescriptionFormat: '{xDescription}.'
        }
    },

    mapNavigation: {
        enabled: true
    },
    credits: {
                enabled: false
            },
    tooltip: {
            headerFormat: '',
            pointFormat: `
                <b>{point.site_name}</b><br>
                Physical Address: {point.physical_address}<br>
                Phone Number: {point.tel_no}<br>
                Province: {point.region__name}
            `,
            footerFormat: '',
            xDateFormat: '%Y-%m-%d %H:%M:%S'
    },
    plotOptions: {
        series: {
            marker: {
                fillColor: '#FFFFFF',
                lineWidth: 2,
                lineColor: Highcharts.getOptions().colors[1]
            }
        }
    },

    series: [{
        mapData,
        name: 'South Africa',
        borderColor: '#707070',
        nullColor: 'rgba(200, 200, 200, 0.3)',
        showInLegend: false
    }, {
        type: 'mappoint',
        name: 'Stores',
        dataLabels: {
            format: '{point.site_name}'  
        },
        data: convertedStoreData  
    }]
});

};*/

    // Function to fetch store data based on the selected province
   
    //const fetchStores = async (province_store, store,month) => {
    //    const response = await fetch(`/get_map_data/?province_store=${province_store}&store=${store}&month=${month}`);
    //    return await response.json();
    //};
    const fetchStoresScores = async (province_store, store,month) => {
        const response = await fetch(`/get_store_data_store_level/?province_store=${province_store}&store=${store}&month=${month}`);
        return await response.json();
    };

      //Visualizations page 
     const filterDropdownbyStoreProvince = document.getElementById('filterprovincestore');
    //const filterDropdownbyStoreOwnerFranchise = document.getElementById('filterownerfranchise');
    const filterDropdownbyStoreStore = document.getElementById('filterstore');
    //const filterDropdownfrom= document.getElementById('fromDate');
    //const filterDropdownto= document.getElementById('toDate');
    const filterDropdownmonth= document.getElementById('month');
    const filterButton = document.getElementById('filterstore');
    filterButton.addEventListener('change', async () => {
        const selectedStore = filterButton.value;
        const selectedmonth = filterDropdownmonth.value; 

        // Perform other actions with the selected values
        console.log('Selected Store:', selectedStore);
        console.log('Selected Month:', selectedmonth);

        // Rest of your code...
        const filteredStoresResponseStorelevel = await fetchStoresScores('', selectedStore, selectedmonth);
        const filteredStoresStorelevel = await filteredStoresResponseStorelevel;
        creategaugeChartoutsidestorelevel(filteredStoresStorelevel);
        creategaugeChartinsidestorelevel(filteredStoresStorelevel);
        creategaugeChartmenustorelevel(filteredStoresStorelevel);
        creategaugeChartmccafestorelevel(filteredStoresStorelevel);
        creategaugeChartdrivethrustorelevel(filteredStoresStorelevel);
        creategaugeChartdeliverystorelevel(filteredStoresStorelevel);
    });

    const filterDropdownbyStoreProvince2 = document.getElementById('filterprovincestore');
    //const filterDropdownbyStoreOwnerFranchise = document.getElementById('filterownerfranchise');
    const filterDropdownbyStoreStore2 = document.getElementById('filterstore');
    //const filterDropdownfrom= document.getElementById('fromDate');
    //const filterDropdownto= document.getElementById('toDate');
    const filterDropdownmonth2= document.getElementById('month');
    const filterButton2 = document.getElementById('filterstore');
    // Function to create the Highcharts map chart
    
    const createMapChart = (data) => {
        // Define colors for provinces
        const provinceColors = {
            'Western Cape': '#FF0000', // Red
            'Gauteng': '#00FF00', // Green
            'Limpopo': '#0000FF', // Blue
            // ... Add more provinces and colors as needed
        };

        // Log information about McDonald's stores
        console.log('McDonald\'s stores:', data);
        
        console.log('McDonald\'s stores:', data);
        
        const convertedStoreData = data.map(point => {
        const lat = parseFloat(point.latitude.replace(',', '.')) || 0;
        const lon = parseFloat(point.longitude.replace(',', '.')) || 0;

            return {
                ...point,
                lat,
                lon,
            };
        });

        // Create the Highcharts map chart
        // Create the Highcharts map chart
        // Create the Highcharts map chart
        Highcharts.mapChart('container', {
            title: {
                text: '',
            },
            legend: {
                align: 'left',
                layout: 'vertical',
                floating: true,
            },
            accessibility: {
                point: {
                    valueDescriptionFormat: '{xDescription}.',
                },
            },
            mapNavigation: {
                enabled: true,
            },
            credits: {
                enabled: false,
            },
            tooltip: {
                headerFormat: '',
                pointFormat: `
                    <b></b><br>
                    Audiited:{point.total}  <br>
                `,
                footerFormat: '',
                xDateFormat: '%Y-%m-%d %H:%M:%S',
            },
            plotOptions: {
                series: {
                    marker: {
                        fillColor: '#FFD100', // McDonald's yellow color for markers
                        lineWidth: 2,
                        lineColor: '#FFD100', // McDonald's yellow color for border
                    },
                },
            },
            series: [{
                mapData,  // Ensure that mapData is defined
                name: 'South Africa',
                borderColor: '#FFD100', // McDonald's yellow color for the map border
                color: '#FFD100', // McDonald's yellow color for the map
                showInLegend: false,
            }, {
                type: 'mappoint',
                name: 'Stores',
                dataLabels: {
                    format: '{point.site_name}' + ' - ' + '{point.total}' + ' Stores Audited',
                },
                data: convertedStoreData,
            }],
        }, function(chart) {
            // Get the current date and time
            const currentDate = new Date();

            // Add two hours to the current date's time
            const adjustedDate = new Date(currentDate.getTime() + 2 * 60 * 60 * 1000);

            const formattedDate = Highcharts.dateFormat('%Y-%m-%d %H:%M:%S', adjustedDate);

            // Add the date and time to the chart
            chart.setTitle({
                text: formattedDate,
            });
        });




        // Extracting data for the pie chart
        const pieChartData = data.map(store => ({
            name: store.site_name,
            y: parseInt(store.total),  // Assuming 'total' is a number
            region: store.region,
        }));

        // Custom colors aligned with McDonald's branding
        const mcdonaldsColors = {
            'Eastern Cape': '#FFD100',        // McDonald's yellow
            'Free State': '#FF0000',          // McDonald's red
            'Gauteng': '#FF1493',     // McDonald's yellow
            'KwaZulu-Natal': '#8B4513',       // McDonald's red
            'Limpopo': '#32CD32',              // McDonald's yellow
            'Mpumalanga': '#4B0082',           // McDonald's red
            'North West': '#FFFFFF',           // McDonald's yellow
            'Northern Cape': '#1E90FF',        // McDonald's red
            'Western Cape': '#FFD100',         // McDonald's yellow
        };

        // Map the colors to the pieChartData
        pieChartData.forEach(dataPoint => {
            dataPoint.color = mcdonaldsColors[dataPoint.region];
        });

        // Highcharts Pie Chart Configuration
        Highcharts.chart('container-pie-main', {
            chart: {
                type: 'pie'
            },
            title: {
                text: ''
            },
            credits: {
                enabled: false
            },
            tooltip: {
                pointFormat: '<b>{point.name}</b>: {point.y} stores'
            },
            plotOptions: {
                pie: {
                    colors: pieChartData.map(dataPoint => dataPoint.color)
                }
            },
            series: [{
                name: 'Region',
                colorByPoint: true,
                data: pieChartData
            }]
        });

    };
        
    const creategaugeChart = (data) => {
        // Extract the summary data from the last object in the array
        const summaryData = data[data.length - 1];

        Highcharts.chart('gauge-container', {
            chart: {
                type: 'solidgauge',
            },
            title: {
                text: '',
            },
            credits: {
                enabled: false
            },
            pane: {
                center: ['50%', '77%'],
                size: '100%',
                startAngle: -90,
                endAngle: 90,
                background: {
                    backgroundColor: Highcharts.defaultOptions.legend.backgroundColor || '#EEE',
                    innerRadius: '60%',
                    outerRadius: '100%',
                    shape: 'arc',
                },
            },
            yAxis: {
                min: 0,
                max:'',
                title: {
                    text: '',
                    y: -70,
                },
                stops: [
                    [0.1, '#DF5353'], 
                    [0.5, '#DDDF0D'], 
                    [0.9, '#55BF3B'], 
                ],
                lineWidth: 0,
                tickWidth: 0,
                minorTickInterval: null,
                tickAmount: 2,
                labels: {
                    y: 16,
                },
            },
            series: [{
                name: 'Achieved',
                data: [''],
                tooltip: {
                    valueSuffix: ' units',
                },
            }],
        });

        
    };
    const creategaugeChartoutsidestorelevel = (data) => {
        // Extract the summary data from the last object in the array
        const summaryData = data[data.length - 1];

        // Assuming summaryData.total_score_outside and summaryData.target_outside are both numeric values
        const achievedPercentage = Math.round((summaryData.total_score_outside / summaryData.target_outside) * 100);
        let color;
        if (achievedPercentage >= 0 && achievedPercentage < 20) {
            color = 'red';
        } else if (achievedPercentage >= 20 && achievedPercentage < 65) {
            color = 'orange';
        } else {
            color = 'green';
        }
        Highcharts.chart('gauge-container-outside-store-level', {
            chart: {
                type: 'solidgauge',
            },
            title: {
                text: '',
            },
            credits: {
                enabled: false
            },
            pane: {
                center: ['50%', '77%'],
                size: '100%',
                startAngle: -90,
                endAngle: 90,
                background: {
                    backgroundColor: Highcharts.defaultOptions.legend.backgroundColor || '#EEE',
                    innerRadius: '60%',
                    outerRadius: '100%',
                    shape: 'arc',
                },
            },
            yAxis: {
                min: 0,
                max: 100,
                title: {
                    text: '',
                    y: -70,
                },
                stops: [
                    [0.1, 'red'],    // Red for 0% - 20%
                    [0.5, 'orange'], // Orange for 20% - 65%
                    [0.9, 'green'],  // Green for 65% - 100%
                ],
                lineWidth: 0,
                tickWidth: 0,
                minorTickInterval: null,
                tickAmount: 2,
                labels: {
                    y: 16,
                    formatter: function () {
                        // Hide labels for 0% and 100%
                        if (this.value === 0 || this.value === 100) {
                            return '';
                        } else {
                            return this.value + '%';
                        }
                    },
                },
            },
            series: [{
                name: 'Achieved',
                data: [achievedPercentage],
                dataLabels: {
                    format: '{y}%',
                    borderWidth: 0,
                    y: 10,
                    style: {
                        fontSize: '100%', // Adjust the font size as needed
                        color: color,   // Set the color to green
                    },
                },
                tooltip: {
                    valueSuffix: '%',
                },
            }],
        });



        var displayT = document.getElementById('displayT');
        var displayTname = document.getElementById('displayTname');
        var displayTextElement3 = document.getElementById('displayText3');
        var displayTextElement8 = document.getElementById('displayText8');
        displayT.innerHTML = '<span style="color: black;font-Weight:bold;font-size:110%">'+'Date: </span>' + summaryData.out_campaign_outside_date;
        displayT.style.color = 'black';
        displayTname.innerHTML = '<span style="color: black;font-Weight:bold;font-size:110%">'+'Store: </span>' + summaryData.out_campaign_outside_store_site_name;
        displayTname.style.color = 'black';
        
            if (summaryData.outside_promotions) {
                displayTextElement3.innerHTML = '<span style="color: black;font-size:110%"><b>1. Were there any My Store marketing promotions/activations outside?</b></span><br>Answer: ' + summaryData.outside_promotions;
                displayTextElement3.style.color = 'green';
                displayTextElement3.style.fontWeight = 'bold';
                displayTextElement3.classList.add('green-text');
                displayTextElement8.innerHTML = '<span style="color: black;font-size:110%"><b>2.If Yes describe The My Store marketing promotions/activations outside and take pictures?</b></span><br>Answer: ' + summaryData.outside_promotions_desc;
                displayTextElement8.style.fontWeight = 'bold';
                // Get the modal
                var modal = document.getElementById("imageModal");

                // Get the image and insert it inside the modal
                var img = document.getElementById("img01");

                // Get the button that opens the modal
                var btn = document.getElementById("showImageBtn");
                btn.style.display = "block";

                // When the user clicks the button, open the modal 
                btn.onclick = function() {
                    modal.style.display = "block";
                    img.src = summaryData.outside_image_url;
                }

                // When the user clicks on <span> (x), close the modal
                var span = document.getElementsByClassName("close")[0];
                span.onclick = function() {
                modal.style.display = "none";
                }

                // When the user clicks anywhere outside of the modal, close it
                window.onclick = function(event) {
                if (event.target == modal) {
                    modal.style.display = "none";
                }
                }

            } else {
                displayTextElement3.innerHTML = '<span style="color: black;font-size:110%"><b>1. Were there any My Store marketing promotions/activations outside?</b></span><br>Answer: ' + summaryData.outside_promotions;
                displayTextElement3.style.color = 'red';
                displayTextElement3.style.fontWeight = 'bold';
                displayTextElement3.classList.add('red-text');
            }

    };

    const creategaugeChartinsidestorelevel = (data) => {
        // Extract the summary data from the last object in the array
        const summaryData = data[data.length - 1];
        const achievedPercentage = Math.round((summaryData.total_score_inside / summaryData.target_inside) * 100);
        let color;
        if (achievedPercentage >= 0 && achievedPercentage < 20) {
            color = 'red';
        } else if (achievedPercentage >= 20 && achievedPercentage < 65) {
            color = 'orange';
        } else {
            color = 'green';
        }
        Highcharts.chart('gauge-container-inside-store-level', {
            chart: {
                type: 'solidgauge',
            },
            title: {
                text: '',
            },
            credits: {
                enabled: false
            },
            pane: {
                center: ['50%', '77%'],
                size: '100%',
                startAngle: -90,
                endAngle: 90,
                background: {
                    backgroundColor: Highcharts.defaultOptions.legend.backgroundColor || '#EEE',
                    innerRadius: '60%',
                    outerRadius: '100%',
                    shape: 'arc',
                },
            },
            yAxis: {
                min: 0,
                max: 100,
                title: {
                    text: '',
                    y: -70,
                },
                stops: [
                    [0.1, 'red'],    // Red for 0% - 20%
                    [0.5, 'orange'], // Orange for 20% - 65%
                    [0.9, 'green'],  // Green for 65% - 100%
                ],
                lineWidth: 0,
                tickWidth: 0,
                minorTickInterval: null,
                tickAmount: 2,
                labels: {
                    y: 16,
                    formatter: function () {
                        // Hide labels for 0% and 100%
                        if (this.value === 0 || this.value === 100) {
                            return '';
                        } else {
                            return this.value + '%';
                        }
                    },
                },
            },
            series: [{
                name: 'Achieved',
                data: [achievedPercentage],
                dataLabels: {
                    format: '{y}%',
                    borderWidth: 0,
                    y: 10,
                    style: {
                        fontSize: '100%', // Adjust the font size as needed
                        color: color,   // Set the color to green
                    },
                },
                tooltip: {
                    valueSuffix: '%',
                },
            }],
        });

        var displayTextElementinside = document.getElementById('displayTextinside');
        var displayinside = document.getElementById('displayinside');
        var displayinsidename = document.getElementById('displayinsidename');
        var displayTextElement12inside = document.getElementById('displayTextinside12');
        
        var displayTextElement2inside = document.getElementById('displayTextinside2');
        var displayTextElement3inside = document.getElementById('displayTextinside3');
        var displayTextElement3insideTvnumber= document.getElementById('displayTextinside3Tvnumber');
        var displayTextElement3insideTvnumberfunctiong= document.getElementById('displayTextinside3Tvnumberfunctioning');
        var displayTextElement4inside = document.getElementById('displayTextinside4');
        var displayTextElement5inside = document.getElementById('displayTextinside5');
        var displayTextElement7inside = document.getElementById('displayTextinside7');
        var displayTextElement77inside = document.getElementById('displayTextinside77');
        var displayTextElement8inside = document.getElementById('displayTextinside8');
        var displayTextElement11inside = document.getElementById('displayTextinside11');
        
        

        var displayTextElement9inside = document.getElementById('displayTextinside9');
        var displayTextElementinside10 = document.getElementById('displayTextinside10');
        displayinside.innerHTML = '<span style="color: black;font-Weight:bold;font-size:110%">'+'Date: </span>' + summaryData.inside_date;
        displayinside.style.color = 'black';
        displayinsidename.innerHTML = '<span style="color: black;font-Weight:bold;font-size:110%">'+'Store: </span>' + summaryData.out_store_site_name;
        displayinsidename.style.color = 'black';
        
            // Change the text content
            if (summaryData.inside_entry_campaigns) {
                displayTextElementinside.innerHTML = '<span style="color: black;font-size:110%"><b>1.Did you notice any campaigns as you entered the store?</b></span><br>Answer: ' + summaryData.inside_entry_campaigns;
                displayTextElementinside.style.fontWeight = 'bold';
                displayTextElementinside10.innerHTML = '<span style="color: black;font-Weight:bold;font-size:110%"><b>' + 'If yes, Which campaignsdid you notice as you entered the store</b></span><br>Answer:' + summaryData.inside_entry_campaigns_list;
            } else {
                displayTextElementinside.innerHTML = '<span style="color: black;font-size:110%"><b>1.Did you notice any campaigns as you entered the store?</b></span><br>Answer: ' + summaryData.inside_entry_campaigns;
                displayTextElementinside.style.fontWeight = 'bold';
            }
            
            if (summaryData.inside_happymeal_layout) {
                displayTextElement7inside.innerHTML = '<span style="color:black;font-size:110%"><b>8.Is the happy meal campaign the same as new campaigns layout?</b></span><br>Answer: ' + summaryData.inside_happymeal_layout;
                displayTextElement7inside.style.color = 'green';
                displayTextElement7inside.style.fontWeight = 'bold';
                displayTextElement7inside.classList.add('green-text');
                displayTextElement77inside.innerHTML = '<span style="color:black;font-size:110%"><b>If Yes, which happy meal campaign currently displaying?</b></span><br>Answer: ' + summaryData.inside_happymeal_campaigns_list;
                displayTextElement77inside.style.fontWeight = 'bold';
                
            } else {
                displayTextElement7inside.innerHTML = '<span style="color: black;font-size:110%"><b>8.Is the happy meal campaign the same as new campaigns layout?</b></span><br>Answer:' + summaryData.inside_happymeal_layout;
                displayTextElement7inside.style.color = 'red';
                displayTextElement7inside.style.fontWeight = 'bold';
                displayTextElement7inside.classList.add('red-text');
                displayTextElement77inside.innerHTML = '<span style="color:black;font-size:110%"><b>If No,give a brief description of the happy meal campaign?</b></span><br>Answer: ' + summaryData.inside_happymeal_layout_desc;
                displayTextElement77inside.style.fontWeight = 'bold';
            }
            
            if (summaryData.inside_music) {
                displayTextElement2inside.innerHTML = '<span style="color:black;font-size:110%"><b>2.Was music playing inside the store?</b></span><br>Answer: ' + summaryData.inside_music;
                displayTextElement2inside.style.color = 'green';
                displayTextElement2inside.style.fontWeight = 'bold';
                displayTextElement2inside.classList.add('green-text');
                
            } else {
                displayTextElement2inside.innerHTML = '<span style="color: black;font-size:110%"><b>2.Was music playing inside the store?</b></span><br>Answer:' + summaryData.inside_music;
                displayTextElement2inside.style.color = 'red';
                displayTextElement2inside.style.fontWeight = 'bold';
                displayTextElement2inside.classList.add('red-text');
            }

            if (summaryData.inside_television) {
                displayTextElement12inside.innerHTML = '<span style="color:black;font-size:110%"><b>3.Does the store have TV screens?</b></span><br>Answer: ' + summaryData.inside_television;
                displayTextElement12inside.style.color = 'green';
                displayTextElement12inside.style.fontWeight = 'bold';
                displayTextElement12inside.classList.add('green-text');
                displayTextElement3inside.innerHTML = '<span style="color:black;font-size:110%"><b>If yes,how many TV screens does the store have, and how many are currently function</b></span><br>';
                displayTextElement3insideTvnumber.innerHTML = '<span style="color:black;font-size:110%"><b>Total number of TV screens in the store</b></span><br>:'+summaryData.inside_television_number;
                displayTextElement3insideTvnumberfunctiong.innerHTML = '<span style="color:black;font-size:110%"><b>Number of functioning TV screens</b></span><br>'+summaryData.inside_television_number_work;
                displayTextElement3inside.style.fontWeight = 'bold';
                
                
            } else {
                displayTextElement12inside.innerHTML = '<span style="color: black;font-size:110%"><b>3.Does the store have TV screens?</b></span><br>Answer:' + summaryData.inside_television;
                displayTextElement12inside.style.color = 'red';
                displayTextElement12inside.style.fontWeight = 'bold';
                displayTextElement12inside.classList.add('red-text');
            }
            if (summaryData.inside_avail_sok) {
                displayTextElement4inside.innerHTML = '<span style="color: black;font-size:110%"><b>4.Does the store have SOKs and fully functioning?</b></span><br>Answer:' + summaryData.inside_avail_sok;
                displayTextElement4inside.style.color = 'green';
                displayTextElement4inside.classList.add('green-text');
                displayTextElement4inside.style.fontWeight = 'bold';
                
            } else {
                displayTextElement4inside.innerHTML = '<span style="color: black;font-size:110%"><b>4.Does the store have SOKs and fully functioning?</b></span><br>Answer:' + summaryData.inside_avail_sok;
                displayTextElement4inside.style.color = 'red';
                displayTextElement4inside.style.fontWeight = 'bold';
                displayTextElement4inside.classList.add('red-text');
            }
            if (summaryData.inside_sok_layout) {
                displayTextElement9inside.innerHTML = '<span style="color: black;font-size:110%"><b>5.Is the SOKs (self-ordering menu) the same as the new McDonald layout?</b></span><br>Answer:' + summaryData.inside_sok_layout;
                displayTextElement9inside.style.color = 'green';
                displayTextElement9inside.classList.add('green-text');
                displayTextElement9inside.style.fontWeight = 'bold';
                displayTextElement8inside.innerHTML = '<span style="color: black;font-size:110%"><b>If yes, did you see the following promotions displayed on the SOK(Self Ordering Kiosk)?</b></span><br>Answer:' + summaryData.inside_sok_campaigns_list;
                displayTextElement8inside.style.fontWeight = 'bold';
                
            } else {
                displayTextElement9inside.innerHTML = '<span style="color: black;font-size:110%"><b>5.Is the SOKs (self-ordering menu) the same as the new McDonald layout?</b></span><br>Answer:' + summaryData.inside_sok_layout;
                displayTextElement9inside.style.color = 'red';
                displayTextElement9inside.style.fontWeight = 'bold';
                displayTextElement9inside.classList.add('red-text');
                
                displayTextElement8inside.innerHTML = '<span style="color: black;font-size:110%"><b>If no give a brief discussion of SOKs menu?</b></span><br>Answer:' + summaryData.inside_sok_layout_desc;
                displayTextElement8inside.style.fontWeight = 'bold';
                
            }
            if(summaryData.inside_mystore_campaigns)
            {
                displayTextElement11inside.innerHTML =  '<span style="color: black;font-size:110%"><b>6.Were there any My Store marketing promotions/activations?</b></span><br>Answer:' + summaryData.inside_mystore_campaigns;
                displayTextElement11inside.style.fontWeight = 'bold';

                // Get the modal
                var modalinside = document.getElementById("imageModalinside");

                // Get the image and insert it inside the modal
                var imginside = document.getElementById("img01inside");

                // Get the button that opens the modal
                var btninside = document.getElementById("showImageBtninside");
                btninside.style.display = "block";

                // When the user clicks the button, open the modal 
                btninside.onclick = function() {
                    modalinside.style.display = "block";
                    imginside.src = summaryData.inside_mystore_image_url;
                }

                // When the user clicks on <span> (x), close the modal
                var spaninside = document.getElementsByClassName("close")[0];
                spaninside.onclick = function() {
                modalinside.style.display = "none";
                }
                displayTextElement5inside.innerHTML =  '<span style="color: black;font-size:110%"><b>7.Please describe the promotion/activationsTake pictures of the activations</b></span><br>';
                displayTextElement5inside.style.fontWeight = 'bold';
           }else{
            displayTextElement11inside.innerHTML =  '<span style="color: black;font-size:110%"><b>6.Were there any My Store marketing promotions/activations?</b></span><br>Answer:' + summaryData.inside_mystore_campaigns;
                displayTextElement11inside.style.fontWeight = 'bold';
           }
            
    };
    const creategaugeChartmenustorelevel = (data) => {
        // Extract the summary data from the last object in the array
        const summaryData = data[data.length - 1];
        const achievedPercentage = Math.round((summaryData.total_score_Main / summaryData.target_menu) * 100);
        let color;
        if (achievedPercentage >= 0 && achievedPercentage < 20) {
            color = 'red';
        } else if (achievedPercentage >= 20 && achievedPercentage < 65) {
            color = 'orange';
        } else {
            color = 'green';
        }
        Highcharts.chart('gauge-container-menu-store-level', {
            chart: {
                type: 'solidgauge',
            },
            title: {
                text: '',
            },
            credits: {
                enabled: false
            },
            pane: {
                center: ['50%', '77%'],
                size: '100%',
                startAngle: -90,
                endAngle: 90,
                background: {
                    backgroundColor: Highcharts.defaultOptions.legend.backgroundColor || '#EEE',
                    innerRadius: '60%',
                    outerRadius: '100%',
                    shape: 'arc',
                },
            },
            yAxis: {
                min: 0,
                max: 100,
                title: {
                    text: '',
                    y: -70,
                },
                stops: [
                    [0.1, 'red'],    // Red for 0% - 20%
                    [0.5, 'orange'], // Orange for 20% - 65%
                    [0.9, 'green'],  // Green for 65% - 100%
                ],
                lineWidth: 0,
                tickWidth: 0,
                minorTickInterval: null,
                tickAmount: 2,
                labels: {
                    y: 16,
                    formatter: function () {
                        // Hide labels for 0% and 100%
                        if (this.value === 0 || this.value === 100) {
                            return '';
                        } else {
                            return this.value + '%';
                        }
                    },
                },
            },
            series: [{
                name: 'Achieved',
                data: [achievedPercentage],
                dataLabels: {
                    format: '{y}%',
                    borderWidth: 0,
                    y: 10,
                    style: {
                        fontSize: '100%', // Adjust the font size as needed
                        color: color,   // Set the color to green
                    },
                },
                tooltip: {
                    valueSuffix: '%',
                },
            }],
        });

        var displayTextElementmenu = document.getElementById('displayTextmenu');
        var displaymenu = document.getElementById('displaymenu');
        var displaymenuname = document.getElementById('displaymenuname');
        var displayTdigital = document.getElementById('displayTdigital');
        var displayTextElementmenu1 = document.getElementById('displayTextmenu1');
        var displayTextElementmenu2 = document.getElementById('displayTextmenu2');
        var displayTextElementmenu3 = document.getElementById('displayTextmenu3');
        var displayTextElementmenu4 = document.getElementById('displayTextmenu4');
        var displayTextElementmenu5 = document.getElementById('displayTextmenu5');
        var displayTextElementmenu6 = document.getElementById('displayTextmenu6');

        displaymenu.innerHTML = '<span style="color: black;font-Weight:bold;font-size:110%"><b>'+'Date: </b></span>' + summaryData.menu_date;
        displaymenu.style.color = 'black';
        displaymenuname.innerHTML = '<span style="color: black;font-Weight:bold;font-size:110%"><b>'+'Store: </b></span>' + summaryData.description_menu_store_site_name;
        displaymenuname.style.color = 'black';
        displayTdigital.innerHTML = '<span style="color: black;font-Weight:bold;font-size:110%">'+'2.Is the menu Digital or Static?</span>' + summaryData.menu_display;
        displayTdigital.style.color = 'black';
            // Change the text content
            if (summaryData.menu_pop_layout) {
                displayTextElementmenu.innerHTML = '✔1'+'<span style="color: black;font-size:110%"><b>'+'.Was the window POP (Point of Purchase) as per our layout and fully functiong?</b></span><br>Answer: ' + summaryData.menu_pop_layout;
                displayTextElementmenu.style.color = 'green';
                displayTextElementmenu.style.fontWeight = 'bold';
                
            } else {
                displayTextElementmenu.innerHTML = 'x'+'<span style="color:black;font-size:110%"><b>'+'1.Was the window POP (Point of Purchase) as per our layout and fully functiong?</b></span><br>Answer: '  + summaryData.menu_pop_layout;
                displayTextElementmenu.style.color = 'red';
                displayTextElementmenu.style.fontWeight = 'bold';
                displayTextElementmenu1.innerHTML= '<span style="color: black;font-size:110%"><b>'+'If no, give a brief description of the condition?</b></span><br>Answer: ' + summaryData.menu_pop_layout_desc;
                displayTextElementmenu1.style.fontWeight = 'bold';
            }
            

            if (summaryData.menu_board_display) {
                displayTextElementmenu3.innerHTML = '✔4'+'<span style="color: black;font-size:110%"><b>'+'.Is the menu board clearly displayed and fully functioning?</b></span><br>Answer: ' + summaryData.menu_board_display;
                displayTextElementmenu3.style.color = 'green';
                displayTextElementmenu3.style.fontWeight = 'bold';
            } else {
                displayTextElementmenu3.innerHTML = 'x'+'<span style="color:black;font-size:110%"><b>'+'4.Is the menu board clearly displayed and fully functioning?</b></span><br>Answer: '  + summaryData.menu_board_display;
                displayTextElementmenu3.style.color = 'red';
                displayTextElementmenu3.style.fontWeight = 'bold';
                displayTextElementmenu4.innerHTML = '<span style="color:black;font-size:110%"><b>'+'If no, give a brief description of the condition?</b></span><br>Answer: '  + summaryData.menu_board_display_desc;
                displayTextElementmenu4.style.fontWeight = 'bold';
            }

            displayTextElementmenu2.innerHTML ='<span style="color:black;font-size:110%"><b>'+'3.Looking at price points, which pricing is being advertised to customers?</b></span><br>Answer: '  + summaryData.menu_pricepoint;
            displayTextElementmenu2.style.fontWeight = 'bold';

            if (summaryData.menu_promotion!=0) {
                let promoCampaigns1 = summaryData.menu_promotion;

                // Format and display the campaigns with the thumbs-up emoji (👍) on new lines
                let formattedCampaigns = '';
                if (Array.isArray(promoCampaigns1)) {
                        // Format and display the campaigns
                        formattedCampaigns = promoCampaigns1.map(campaign => `👍 ${campaign.trim()}.`).join('<br>');
                        // Now you can use formattedCampaigns as needed
                } else {
                                console.error("promoCampaigns is not an array. Check the data structure.");
                }
            } else {
            }

            if (summaryData.menu_board_campaign_layout) {
                displayTextElementmenu6.innerHTML = '✔5'+'<span style="color: black;font-size:110%"><b>'+'.Are menu boards the same as the new campaign layout?</b></span><br>Answer: ' + summaryData.menu_board_campaign_layout;
                displayTextElementmenu6.style.color = 'green';
                displayTextElementmenu6.style.fontWeight = 'bold';
                displayTextElementmenu5.innerHTML = '<span style="color:black;font-size:110%"><b>'+'If yes, did you see the following promotions displayed?</b></span><br>Answer: '  + summaryData.menu_board_campaig_list;
                displayTextElementmenu5.style.fontWeight = 'bold';
            } else {
                displayTextElementmenu6.innerHTML = 'x'+'<span style="color:black;font-size:110%"><b>'+'5.Are menu boards the same as the new campaign layout?</b></span><br>Answer: '  + summaryData.menu_board_campaign_layout;
                displayTextElementmenu6.style.color = 'red';
                displayTextElementmenu6.style.fontWeight = 'bold';
                displayTextElementmenu5.innerHTML = '<span style="color:black;font-size:110%"><b>'+'If no, give a brief description of what you see on menu.</b></span><br>Answer: '  + summaryData.menu_board_campaign_layout_desc;
                displayTextElementmenu5.style.fontWeight = 'bold';
            }
    };
    const creategaugeChartmccafestorelevel = (data) => {
        // Extract the summary data from the last object in the array
        const summaryData = data[data.length - 1];
        const achievedPercentage = Math.round((summaryData.total_score_Mccafe / summaryData.target_mccafe) * 100);
        let color;
        if (achievedPercentage >= 0 && achievedPercentage < 20) {
            color = 'red';
        } else if (achievedPercentage >= 20 && achievedPercentage < 65) {
            color = 'orange';
        } else {
            color = 'green';
        }
        Highcharts.chart('gauge-container-mccafe-store-level', {
            chart: {
                type: 'solidgauge',
            },
            title: {
                text: '',
            },
            credits: {
                enabled: false
            },
            pane: {
                center: ['50%', '77%'],
                size: '100%',
                startAngle: -90,
                endAngle: 90,
                background: {
                    backgroundColor: Highcharts.defaultOptions.legend.backgroundColor || '#EEE',
                    innerRadius: '60%',
                    outerRadius: '100%',
                    shape: 'arc',
                },
            },
            yAxis: {
                min: 0,
                max: 100,
                title: {
                    text: '',
                    y: 10,
                },
                stops: [
                    [0.1, 'red'],    // Red for 0% - 20%
                    [0.5, 'orange'], // Orange for 20% - 65%
                    [0.9, 'green'],  // Green for 65% - 100%
                ],
                lineWidth: 0,
                tickWidth: 0,
                minorTickInterval: null,
                tickAmount: 2,
                labels: {
                    y: 16,
                    formatter: function () {
                        // Hide labels for 0% and 100%
                        if (this.value === 0 || this.value === 100) {
                            return '';
                        } else {
                            return this.value + '%';
                        }
                    },
                },
            },
            series: [{
                name: 'Achieved',
                data: [achievedPercentage],
                dataLabels: {
                    format: '{y}%',
                    borderWidth: 0,
                    y: 10,
                    style: {
                        fontSize: '100%', // Adjust the font size as needed
                        color: color,   // Set the color to green
                    },
                },
                tooltip: {
                    valueSuffix: '%',
                },
            }],
        });

        var displayTextElementmccafe = document.getElementById('displayTextmccafe');
        var displayccafe = document.getElementById('displaymccafe');
        var displayccafename = document.getElementById('displaymccafename');
        var displayTextElementmccafe5 = document.getElementById('displayTextmccafe5');
        
        var displayTextElementmccafe1 = document.getElementById('displayTextmccafe1');
        var displayTextElementmccafe2 = document.getElementById('displayTextmccafe2');
        var displayTextElementmccafe3 = document.getElementById('displayTextmccafe3');
        var displayTextElementmccafe4 = document.getElementById('displayTextmccafe4');
        displayccafe.innerHTML = '<span style="color:black;font-size:110%"><b>'+'Date: </b></span>' + summaryData.mccafe_date;
        displayccafe.style.color = 'black';
        displayccafename.innerHTML = '<span style="color: black;font-size:110%"><b>'+'Store: </b></span>' + summaryData.drive_store_site_name;
        displayccafename.style.color = 'black';
        displayTextElementmccafe5.innerHTML = '<span style="color: black;font-size:110%"><b>'+'2.Is the menu Digital or Static? </b></span>' + summaryData.mccafe_menu;
        displayTextElementmccafe5.style.color = 'black';
        // Change the text content
          if (summaryData.mccafe_menu_display) {
                displayTextElementmccafe.innerHTML = '✔'+'<span style="color:black;font-size:110%"><b>'+'3.Is the menu clearly displayed and fully functioning?</b></span><br>Answer:' + summaryData.mccafe_menu_display;
                displayTextElementmccafe.style.color = 'green';
                displayTextElementmccafe.style.fontWeight = 'bold';
            } else {
                displayTextElementmccafe.innerHTML = 'x3'+'<span style="color: black;font-size:110%"><b>'+'Is the menu clearly displayed and fully functioning?</b></span><br>Answer:'  + summaryData.mccafe_menu_display;
                displayTextElementmccafe.style.color = 'red';
                displayTextElementmccafe.style.fontWeight = 'bold';
                displayTextElementmccafe3.innerHTML ='<span style="color: black;font-size:110%"><b>'+'If no, give a brief description of the condition.?</b></span><br>Answer:'  + summaryData.mccafe_menu_display_desc;
                displayTextElementmccafe3.style.fontWeight = 'bold';
            }
            displayTextElementmccafe1.innerHTML = '<span style="color:black;font-size:110%"><b>1.Model of McCafé?</b></span>'+'<br>Answer:'+summaryData.mccafe_model;
            displayTextElementmccafe1.style.fontWeight = 'bold';

            if (summaryData.mccafe_menu_board_campaign_layout) {
                displayTextElementmccafe2.innerHTML = '✔'+'<span style="color:black;font-size:110%"><b>'+'4.is menu the same as the new campaign layout?</b></span><br>Answer:' + summaryData.mccafe_menu_board_campaign_layout;
                displayTextElementmccafe2.style.color = 'green';
                displayTextElementmccafe2.style.fontWeight = 'bold';
                displayTextElementmccafe4.innerHTML ='<span style="color: black;font-size:110%"><b>'+'If yes, did you see the following promotions displayed on the menu?</b></span><br>Answer:'  + summaryData.mccafe_menu_board_layout_campaign_list;
                displayTextElementmccafe4.style.fontWeight = 'bold';
            } else {
                displayTextElementmccafe2.innerHTML = 'x4'+'<span style="color: black;font-size:110%"><b>'+'is menu the same as the new campaign layout?</b></span><br>Answer:'  + summaryData.mccafe_menu_board_campaign_layout;
                displayTextElementmccafe2.style.color = 'red';
                displayTextElementmccafe2.style.fontWeight = 'bold';
                displayTextElementmccafe4.innerHTML ='<span style="color: black;font-size:110%"><b>'+'If no, give a brief description of what you see on menu.?</b></span><br>Answer:'  + summaryData.mccafe_menu_board_campaign_layout_desc;
                displayTextElementmccafe4.style.fontWeight = 'bold';
            }
    };

    const creategaugeChartdrivethrustorelevel = (data) => {
        // Extract the summary data from the last object in the array
        const summaryData = data[data.length - 1];
        const achievedPercentage = Math.round((summaryData.total_score_drivethru / summaryData.target_drivethru) * 100);
        let color;
        if (achievedPercentage >= 0 && achievedPercentage < 20) {
            color = 'red';
        } else if (achievedPercentage >= 20 && achievedPercentage < 65) {
            color = 'orange';
        } else {
            color = 'green';
        }
        Highcharts.chart('gauge-container-drivethru-store-level', {
            chart: {
                type: 'solidgauge',
            },
            title: {
                text: '',
            },
            credits: {
                enabled: false
            },
            pane: {
                center: ['50%', '77%'],
                size: '100%',
                startAngle: -90,
                endAngle: 90,
                background: {
                    backgroundColor: Highcharts.defaultOptions.legend.backgroundColor || '#EEE',
                    innerRadius: '60%',
                    outerRadius: '100%',
                    shape: 'arc',
                },
            },
            yAxis: {
                min: 0,
                max: 100,
                title: {
                    text: '',
                    y: -70,
                },
                stops: [
                    [0.1, 'red'],    // Red for 0% - 20%
                    [0.5, 'orange'], // Orange for 20% - 65%
                    [0.9, 'green'],  // Green for 65% - 100%
                ],
                lineWidth: 0,
                tickWidth: 0,
                minorTickInterval: null,
                tickAmount: 2,
                labels: {
                    y: 16,
                    formatter: function () {
                        // Hide labels for 0% and 100%
                        if (this.value === 0 || this.value === 100) {
                            return '';
                        } else {
                            return this.value + '%';
                        }
                    },
                },
            },
            series: [{
                name: 'Achieved',
                data: [achievedPercentage],
                dataLabels: {
                    format: '{y}%',
                    borderWidth: 0,
                    y: 10,
                    style: {
                        fontSize: '100%', // Adjust the font size as needed
                        color: color,   // Set the color to green
                    },
                },
                tooltip: {
                    valueSuffix: '%',
                },
            }],
        });
        var displayTextElementdrivethru = document.getElementById('displayTextdrivethru');
        var displaydrivethru = document.getElementById('displaydrivethru');
        var displaydrivethruname = document.getElementById('displaydrivethruname');
        
        var displayTextElementdrivethru1 = document.getElementById('displayTextdrivethru1');
        var displayTextElementdrivethru2 = document.getElementById('displayTextdrivethru2');
        var displayTextElementdrivethru3 = document.getElementById('displayTextdrivethru3');
        var displayTextElementdrivethru33 = document.getElementById('displayTextdrivethru33');
        var displayTextElementdrivethru333 = document.getElementById('displayTextdrivethru333');
        var displayTextElementdrivethru333advert = document.getElementById('displayTextdrivethru333advert');
        var displayTextElementdrivethru333advertdesc = document.getElementById('displayTextdrivethru333advertdesc');
        var displayTextElementdrivethru4 = document.getElementById('displayTextdrivethru4');
        var displayTextElementdrivethru5 = document.getElementById('displayTextdrivethru5');
        displaydrivethru.innerHTML = '<span style="color: black;font-Weight:bold;font-size:110%"><b>'+'Date: </b></span>' + summaryData.drivethru_date;
        displaydrivethru.style.color = 'black';
        displaydrivethruname.innerHTML = '<span style="color: black;font-Weight:bold;font-size:110%"><b>'+'Store: </b></span>' + summaryData.drive_store_site_name;
        displaydrivethruname.style.color = 'black';
        displayTextElementdrivethru5.innerHTML = '<span style="color: black;font-Weight:bold;font-size:110%"><b>'+'2.is the drive thru menu static or digital?</b></span>' + summaryData.drive_menu;
        displayTextElementdrivethru5.style.color = 'black';
        displayTextElementdrivethru5.style.fontWeight = 'bold';
        if (summaryData.is_drivethru) {
                displayTextElementdrivethru.innerHTML = '<span style="color: black;font-size:110%"><b>'+'1.Does the store have Drive-Thru? (if no, skip to the section)?</b></span><br>Answer:' + summaryData.is_drivethru;
                displayTextElementdrivethru.style.fontWeight = 'bold';
                
            } else {
                displayTextElementdrivethru.innerHTML ='<span style="color:black;font-size:110%"><b>'+'1.Does the store have Drive-Thru? (if no, skip to the section)?</b></span><br>Answer: '  + summaryData.is_drivethru;
                displayTextElementdrivethru.style.fontWeight = 'bold';
            }
            
            if (summaryData.drive_menu_board) {
                displayTextElementdrivethru1.innerHTML = '✔3'+'<span style="color: black;font-size:110%"><b>'+'.Is the menu board clearly displayed and fully functioning?</b></span><br>Answer: ' + summaryData.drive_menu_board;
                displayTextElementdrivethru1.style.color = 'green';
                displayTextElementdrivethru1.style.fontWeight = 'bold';
                
            } else {
                displayTextElementdrivethru1.innerHTML = 'x'+'<span style="color:black;font-size:110%"><b>'+'3.Is the menu board clearly displayed and fully functioning?</b></span><br>Answer: '  + summaryData.drive_menu_board;
                displayTextElementdrivethru1.style.color = 'red';
                displayTextElementdrivethru1.style.fontWeight = 'bold';
                displayTextElementdrivethru4.innerHTML = '<span style="color:black;font-size:110%"><b>'+'If no, give a brief description of the condition.</b></span><br>Answer: '  + summaryData.drive_menu_board_desc;
                displayTextElementdrivethru4.style.fontWeight = 'bold';
            }

            if (summaryData.drive_menu_board_campaign_layout) {
                displayTextElementdrivethru2.innerHTML = '✔4'+'<span style="color: black;font-size:110%"><b>'+'.is menu the same as the new campaign layout?</b></span><br>Answer: ' + summaryData.drive_menu_board_campaign_layout;
                displayTextElementdrivethru2.style.color = 'green';
                displayTextElementdrivethru2.style.fontWeight = 'bold';
                displayTextElementdrivethru3.innerHTML = '<span style="color: black;font-size:110%"><b>If yes, Which campaigns did you notice as you drove in?</b></span><br>Answer:' +summaryData.drive_menu_board_layout_campaign_list;
                displayTextElementdrivethru3.style.fontWeight = 'bold';
                
            } else {
                displayTextElementdrivethru2.innerHTML = 'x'+'<span style="color:black;font-size:110%"><b>'+'4.is menu the same as the new campaign layout?</b></span><br>Answer: '  + summaryData.drive_menu_board_campaign_layout;
                displayTextElementdrivethru2.style.color = 'red';
                displayTextElementdrivethru2.style.fontWeight = 'bold';
                displayTextElementdrivethru3.innerHTML = '<span style="color: black;font-size:110%"><b>If not, give a brief description of what you see on menu.</b></span><br>Answer:' +summaryData.drive_menu_board_campaign_layout_desc;
                displayTextElementdrivethru3.style.fontWeight = 'bold';
            }

            if (summaryData.drive_cod_layout) {
                displayTextElementdrivethru33.innerHTML = '✔5'+'<span style="color: black;font-size:110%"><b>'+'.Is the COD (customer order display) the same as the new advertising layout?</b></span><br>Answer: ' + summaryData.drive_cod_layout;
                displayTextElementdrivethru33.style.color = 'green';
                displayTextElementdrivethru33.style.fontWeight = 'bold';
                
            } else {
                displayTextElementdrivethru33.innerHTML = 'x'+'<span style="color:black;font-size:110%"><b>'+'5.Is the COD (customer order display) the same as the new advertising layout? </b></span><br>Answer: '  + summaryData.drive_cod_layout;
                displayTextElementdrivethru33.style.color = 'red';
                displayTextElementdrivethru33.style.fontWeight = 'bold';
                displayTextElementdrivethru333.innerHTML = '<span style="color: black;font-size:110%"><b>If no, give brief description of what you see on COD (customer order display)</b></span><br>Answer:' +summaryData.drive_cod_layout_desc;
                displayTextElementdrivethru333.style.fontWeight = 'bold';
            }

            
            if (summaryData.drive_advert) {
                displayTextElementdrivethru333advert.innerHTML = '<span style="color: black;font-size:110%"><b>'+'6.Are there any advertising/activations observed above related to any ongoing promotions?  </b></span><br>Answer: ' + summaryData.drive_advert;
                displayTextElementdrivethru333advert.style.fontWeight = 'bold';
                
            } else {
                displayTextElementdrivethru333advert.innerHTML = '<span style="color:black;font-size:110%"><b>'+'6.Are there any advertising/activations observed above related to any ongoing promotions?</b></span><br>Answer: '  + summaryData.drive_advert;
                displayTextElementdrivethru333advert.style.fontWeight = 'bold';
                displayTextElementdrivethru333advertdesc.innerHTML = '<span style="color: black;font-size:110%"><b>'+'If no, please describe the advertising/activation. </b></span><br>Answer: ' + summaryData.drive_advert_desc;
                displayTextElementdrivethru333advertdesc.style.fontWeight = 'bold';
            }
            let driveThruElement = document.getElementById('driveThruHeader');

            // Check the conditions
            if (
            summaryData.drivethru_campaign === "N/A" &&
            summaryData.customer_order_display === 'N/A' &&
            summaryData.activation_description === 'N/A'
            ) {
            // If the conditions are true, add a red line in the middle of "Drive-thru"
            driveThruElement.innerHTML = '<span style="position: relative;">Drive<span style="border-top: 2px solid red; display: inline-block; position: absolute; top: 50%; transform: translateY(-50%); margin: 0 2px;"></span>thru <span style="color: red;">x</span></span>';
            } else {
            // If the conditions are false, display "Drive-thru" without the red line
            driveThruElement.innerHTML = 'Drive-thru';
            }

    };

    const creategaugeChartdeliverystorelevel = (data) => {
        // Extract the summary data from the last object in the array
        const summaryData = data[data.length - 1];
        const achievedPercentage = Math.round((summaryData.total_score_delivery/ summaryData.target_delivery) * 100);
        let color;
        if (achievedPercentage >= 0 && achievedPercentage < 20) {
            color = 'red';
        } else if (achievedPercentage >= 20 && achievedPercentage < 65) {
            color = 'orange';
        } else {
            color = 'green';
        }
        console.log('mccafe');
        console.log(summaryData.drivethru_date);

        var mccafedisplay = document.getElementById("nomccafedisplay");
        var drivethrudisplay = document.getElementById("nodrivedisplay");
        var disclaimermccafeDiv = document.getElementById("disclaimermccafe");
        var disclaimerdriveDiv = document.getElementById("disclaimerdrive");

        // Calculate total percentage based on different conditions
        var total_percentage;
        console.log('Displays:::')
        console.log(summaryData.mccafe_model)
        console.log(summaryData.is_drivethru)
        if ((summaryData.mccafe_model === '4' || summaryData.mccafe_model === '5') && !summaryData.is_drivethru) {
            // If both dates are 0, hide both displays
            disclaimerdriveDiv.style.display = "block";
            disclaimermccafeDiv.style.display = "block";

            mccafedisplay.style.display = "none";
            drivethrudisplay.style.display = "none";
            
            total_percentage = (summaryData.total_score_delivery + summaryData.total_score_Main + summaryData.total_score_inside + summaryData.total_score_outside) / 10;
        } else if ((summaryData.mccafe_model === '4' || summaryData.mccafe_model === '5')) {
            // If mccafe_date is 0, hide mccafedisplay
            disclaimermccafeDiv.style.display = "block";
            disclaimerdriveDiv.style.display = "none";

            mccafedisplay.style.display = "none";
            drivethrudisplay.style.display = "block";
            total_percentage = (summaryData.total_score_delivery + summaryData.total_score_drivethru + summaryData.total_score_Main + summaryData.total_score_inside + summaryData.total_score_outside) / 12;
        } else if (!summaryData.is_drivethru) {
            // If drivethru_date is 0, hide drivethrudisplay

            disclaimermccafeDiv.style.display = "none";
            disclaimerdriveDiv.style.display = "block";

            mccafedisplay.style.display = "block";
            drivethrudisplay.style.display = "none";
            total_percentage = (summaryData.total_score_delivery + summaryData.total_score_Mccafe + summaryData.total_score_Main + summaryData.total_score_inside + summaryData.total_score_outside) / 12;
        } else {
            // Default case, show both displays
            disclaimermccafeDiv.style.display = "none";
            disclaimerdriveDiv.style.display = "none";
            mccafedisplay.style.display = "block";
            drivethrudisplay.style.display = "block";
            total_percentage = (summaryData.total_score_delivery + summaryData.total_score_drivethru + summaryData.total_score_Mccafe + summaryData.total_score_Main + summaryData.total_score_inside + summaryData.total_score_outside) / 15;
        }

        // Round the total percentage to two decimal places
        total_percentage = Math.round(total_percentage * 100);

        let color1;
        if (total_percentage >= 0 && total_percentage < 20) {
            color1 = 'red';
        } else if (total_percentage>= 20 && total_percentage < 65) {
            color1 = 'orange';
        } else {
            color1 = 'green';
        }
        console.log('Total Percentage:', total_percentage);
        // Create the chart using Highcharts
        Highcharts.chart('container-compare', {
            chart: {
                        type: 'solidgauge',
                    },
                    title: {
                        text: summaryData.selected_store_name,
                    },
                    credits: {
                        enabled: false
                    },
                    pane: {
                        center: ['50%', '77%'],
                        size: '100%',
                        startAngle: -90,
                        endAngle: 90,
                        background: {
                            backgroundColor: Highcharts.defaultOptions.legend.backgroundColor || '#EEE',
                            innerRadius: '60%',
                            outerRadius: '100%',
                            shape: 'arc',
                        },
                    },
                    yAxis: {
                        min: 0,
                        max: 100, // Assuming total_score_outside is a percentage (adjust as needed)
                        title: {
                            text: '',
                            y: -70,
                        },
                        stops: [
                            [0.1, 'red'],    // Red for 0% - 20%
                            [0.6, 'orange'], // Orange for 20% - 65%
                            [0.9, 'green'],  // Green for 65% - 100%
                        ],
                        lineWidth: 0,
                        tickWidth: 0,
                        minorTickInterval: null,
                        tickAmount: 2,
                        labels: {
                            y: 16,
                        },
                    },
                    series: [{
                        name: 'Achieved',
                        data: [total_percentage],
                        dataLabels: {
                            format: '{y}%',
                            borderWidth: 0,
                            y: 10,
                            style: {
                                fontSize: '170%', // Adjust the font size as needed
                                color: color1,   // Set the color to green
                            },
                        },
                        tooltip: {
                            valueSuffix: '%',
                        },
                    }],
                    
        });
        

        // Assuming you have individual scores and target values
        const data2 = {
        total_score_Main: summaryData.total_score_Main,
        ...((summaryData.mccafe_model !== '4' || summaryData.mccafe_model !== '5') && { total_score_Mccafe: summaryData.total_score_Mccafe }),
        ...(summaryData.drivethru_date && {  total_score_drivethru: summaryData.total_score_drivethru}),
        total_score_delivery: summaryData.total_score_delivery,
        total_score_inside: summaryData.total_score_inside,
        };

        const targets = {
        target_Main: 3,
        ...((summaryData.mccafe_model !== '4' || summaryData.mccafe_model !== '5') && { target_Mccafe: 2 }),
        ...(summaryData.drivethru_date && {target_drivethru: 3 }),
        target_delivery: 2,
        target_inside: 4,
        };
        // Create series data for bars
        const barData = Object.values(data2);
        const targetData = Object.values(targets);

        // Calculate total percentage
        const total_percentage2 = (barData.reduce((acc, score) => acc + score, 0) / (barData.length * 100)) * 100;

        // Create the chart using Highcharts
        // Calculate the total sum of scores
        const totalSum = (
            summaryData.total_score_delivery +
            summaryData.total_score_drivethru +
            summaryData.total_score_Mccafe +
            summaryData.total_score_Main +
            summaryData.total_score_inside 
        );

        // Convert scores to percentages
        const percentageDelivery = (summaryData.total_score_delivery / totalSum) * 100;
        const percentageDriveThru = (summaryData.total_score_drivethru / totalSum) * 100;
        const percentageMccafe = (summaryData.total_score_Mccafe / totalSum) * 100;
        const percentageMain = (summaryData.total_score_Main / totalSum) * 100;
        const percentageInside = (summaryData.total_score_inside / totalSum) * 100;

        

        Highcharts.chart('container-compare-bar', {
        chart: {
            type: 'column'
        },
        title: {
            text: summaryData.selected_store_name
        },
        xAxis: {
            categories: Object.keys(data2)
        },
        yAxis: {
            title: {
            text: 'Score'
            }
        },
        plotOptions: {
            column: {
            stacking: 'normal',
            dataLabels: {
                enabled: true
            }
            }
        },
        series: [{
            name: 'Score',
            data: barData,
            color: '#FFD200' // Adjust the color as needed
        }, {
            name: 'Target',
            type: 'line',
            data: targetData,
            color: 'red' // Adjust the color as needed
        }],
        credits: {
            enabled: false
        }
        });

        Highcharts.chart('gauge-container-delivery-store-level', {
            chart: {
                type: 'solidgauge',
            },
            title: {
                text: '',
            },
            credits: {
                enabled: false
            },
            pane: {
                center: ['50%', '77%'],
                size: '100%',
                startAngle: -90,
                endAngle: 90,
                background: {
                    backgroundColor: Highcharts.defaultOptions.legend.backgroundColor || '#EEE',
                    innerRadius: '60%',
                    outerRadius: '100%',
                    shape: 'arc',
                },
            },
            yAxis: {
                min: 0,
                max: 100,
                title: {
                    text: '',
                    y: -70,
                },
                stops: [
                    [0.1, 'red'],    // Red for 0% - 20%
                    [0.5, 'orange'], // Orange for 20% - 65%
                    [0.9, 'green'],  // Green for 65% - 100%
                ],
                lineWidth: 0,
                tickWidth: 0,
                minorTickInterval: null,
                tickAmount: 2,
                labels: {
                    y: 16,
                    formatter: function () {
                        // Hide labels for 0% and 100%
                        if (this.value === 0 || this.value === 100) {
                            return '';
                        } else {
                            return this.value + '%';
                        }
                    },
                },
            },
            series: [{
                name: 'Achieved',
                data: [achievedPercentage],
                dataLabels: {
                    format: '{y}%',
                    borderWidth: 0,
                    y: 10,
                    style: {
                        fontSize: '100%', // Adjust the font size as needed
                        color: color,   // Set the color to green
                    },
                },
                tooltip: {
                    valueSuffix: '%',
                },
            }],
        });
        var displayTextElementdelivery = document.getElementById('displayTextdelivery');
        var displaydelivery = document.getElementById('displaydelivery');
        var displaydeliveryname = document.getElementById('displaydeliveryname');
        var displayTextElementdelivery1 = document.getElementById('displayTextdelivery1');
        displaydelivery.innerHTML = '<span style="color: black;font-Weight:bold;font-size:110%"><b>'+'Date: </b></span>' + summaryData.delivery_date;
        displaydelivery.style.color = 'black';
        displaydeliveryname.innerHTML = '<span style="color: black;font-Weight:bold;font-size:110%"><b>'+'Store: </b></span>' + summaryData.store_site_name;
        displaydeliveryname.style.color = 'black';
        if (summaryData.mcdelivery) {
                displayTextElementdelivery.innerHTML = '✔'+'<span style="color: black;font-Weight:bold;font-size:110%"><b>'+'1.Is the McDelivery advertising visible?</b></span><br>Answer: ' + summaryData.mcdelivery;
                displayTextElementdelivery.style.color = 'green';
                displayTextElementdelivery.style.fontWeight = 'bold';
                
            } else {
                displayTextElementdelivery.innerHTML = 'x'+'<span style="color: black;font-Weight:bold;font-size:110%"><b>'+'1.Is the McDelivery advertising visible?</b></span><br>Answer: '  + summaryData.mcdelivery;
                displayTextElementdelivery.style.color = 'red';
                displayTextElementdelivery.style.fontWeight = 'bold';
            }
            if (summaryData.drive_other) {
                displayTextElementdelivery1.innerHTML = '✔'+'<span style="color: black;font-Weight:bold;font-size:110%"><b>'+'2.Did you see Any Delivery advertising from 3 rd party (Uber eats or MrD)?</b></span><br>Answer: ' + summaryData.drive_other;
                displayTextElementdelivery1.style.color = 'green';
                displayTextElementdelivery1.style.fontWeight = 'bold';
                
            } else {
                displayTextElementdelivery1.innerHTML = 'x'+'<span style="color: black;font-Weight:bold;font-size:110%"><b>'+'2.Did you see Any Delivery advertising from 3 rd party (Uber eats or MrD)?</b></span><br>Answer:'  + summaryData.drive_other;
                displayTextElementdelivery1.style.color = 'red';
                displayTextElementdelivery1.style.fontWeight = 'bold';
            }

    };
    

    const creategaugeChartinside = (data) => {
        // Extract the summary data from the last object in the array
        const summaryData = data[data.length - 1];

        Highcharts.chart('gauge-container-inside', {
            chart: {
                type: 'solidgauge',
            },
            title: {
                text: '',
            },
            credits: {
                enabled: false
            },
            pane: {
                center: ['50%', '77%'],
                size: '100%',
                startAngle: -90,
                endAngle: 90,
                background: {
                    backgroundColor: Highcharts.defaultOptions.legend.backgroundColor || '#EEE',
                    innerRadius: '60%',
                    outerRadius: '100%',
                    shape: 'arc',
                },
            },
            yAxis: {
                min: 0,
                max: '',
                title: {
                    text: '',
                    y: -70,
                },
                stops: [
                    [0.1, '#DF5353'], 
                    [0.5, '#DDDF0D'], 
                    [0.9, '#55BF3B'],
                ],
                lineWidth: 0,
                tickWidth: 0,
                minorTickInterval: null,
                tickAmount: 2,
                labels: {
                    y: 16,
                },
            },
            series: [{
                name: 'Achieved',
                data: [''],
                tooltip: {
                    valueSuffix: ' units',
                },
            }],
        });

        
    };
    
    const creategaugeChartMainDigitalMenu = (data) => {
        // Extract the summary data from the last object in the array
        const summaryData = data[data.length - 1];

        Highcharts.chart('gauge-container-new2', {
            chart: {
                type: 'solidgauge',
            },
            title: {
                text: '',
            },
            credits: {
                enabled: false
            },
            pane: {
                center: ['50%', '77%'],
                size: '100%',
                startAngle: -90,
                endAngle: 90,
                background: {
                    backgroundColor: Highcharts.defaultOptions.legend.backgroundColor || '#EEE',
                    innerRadius: '60%',
                    outerRadius: '100%',
                    shape: 'arc',
                },
            },
            yAxis: {
                min: 0,
                max: '',
                title: {
                    text: '',
                    y: -70,
                },
                stops: [
                    [0.1, '#DF5353'], 
                    [0.5, '#DDDF0D'], 
                    [0.9, '#55BF3B'],
                ],
                lineWidth: 0,
                tickWidth: 0,
                minorTickInterval: null,
                tickAmount: 2,
                labels: {
                    y: 16,
                },
            },
            series: [{
                name: 'Achieved',
                data: [''],
                tooltip: {
                    valueSuffix: ' units',
                },
            }],
        });

        
    };

    const creategaugeChartDrivethru = (data) => {
        // Extract the summary data from the last object in the array
        const summaryData = data[data.length - 1];

        Highcharts.chart('gauge-container-new1', {
            chart: {
                type: 'solidgauge',
            },
            title: {
                text: '',
            },
            credits: {
                enabled: false
            },
            pane: {
                center: ['50%', '77%'],
                size: '100%',
                startAngle: -90,
                endAngle: 90,
                background: {
                    backgroundColor: Highcharts.defaultOptions.legend.backgroundColor || '#EEE',
                    innerRadius: '60%',
                    outerRadius: '100%',
                    shape: 'arc',
                },
            },
            yAxis: {
                min: 0,
                max: '',
                title: {
                    text: '',
                    y: -70,
                },
                stops: [
                    [0.1, '#DF5353'], 
                    [0.5, '#DDDF0D'], 
                    [0.9, '#55BF3B'],
                ],
                lineWidth: 0,
                tickWidth: 0,
                minorTickInterval: null,
                tickAmount: 2,
                labels: {
                    y: 16,
                },
            },
            series: [{
                name: 'Achieved',
                data: [ ''],
                tooltip: {
                    valueSuffix: ' units',
                },
            }],
        });

        
    };

    const creategaugeChartMcCafMain = (data) => {
        // Extract the summary data from the last object in the array
        const summaryData = data[data.length - 1];

        Highcharts.chart('gauge-container-new4', {
            chart: {
                type: 'solidgauge',
            },
            title: {
                text: '',
            },
            credits: {
                enabled: false
            },
            pane: {
                center: ['50%', '77%'],
                size: '100%',
                startAngle: -90,
                endAngle: 90,
                background: {
                    backgroundColor: Highcharts.defaultOptions.legend.backgroundColor || '#EEE',
                    innerRadius: '60%',
                    outerRadius: '100%',
                    shape: 'arc',
                },
            },
            yAxis: {
                min: 0,
                max: '',
                title: {
                    text: '',
                    y: -70,
                },
                stops: [
                    [0.1, '#DF5353'], 
                    [0.5, '#DDDF0D'], 
                    [0.9, '#55BF3B'],
                ],
                lineWidth: 0,
                tickWidth: 0,
                minorTickInterval: null,
                tickAmount: 2,
                labels: {
                    y: 16,
                },
            },
            series: [{
                name: 'Achieved',
                data: [''],
                tooltip: {
                    valueSuffix: ' units',
                },
            }],
        });

        
    };

    const creategaugeChartDelivery = (data) => {
        // Extract the summary data from the last object in the array
        const summaryData = data[data.length - 1];

        Highcharts.chart('gauge-container-new3', {
            chart: {
                type: 'solidgauge',
            },
            title: {
                text: '',
            },
            credits: {
                enabled: false
            },
            pane: {
                center: ['50%', '77%'],
                size: '100%',
                startAngle: -90,
                endAngle: 90,
                background: {
                    backgroundColor: Highcharts.defaultOptions.legend.backgroundColor || '#EEE',
                    innerRadius: '60%',
                    outerRadius: '100%',
                    shape: 'arc',
                },
            },
            yAxis: {
                min: 0,
                max: '',
                title: {
                    text: '',
                    y: -70,
                },
                stops: [
                    [0.1, '#DF5353'], 
                    [0.5, '#DDDF0D'], 
                    [0.9, '#55BF3B'],
                ],
                lineWidth: 0,
                tickWidth: 0,
                minorTickInterval: null,
                tickAmount: 2,
                labels: {
                    y: 16,
                },
            },
            series: [{
                name: 'Achieved',
                data: [''],
                tooltip: {
                    valueSuffix: ' units',
                },
            }],
        });

        
    };
    
    // Initial rendering of the map with all stores
    //const allStoresResponse = '';
    const filterDropdownbyStoreStorestarts = document.getElementById('filterstore');
    const selectedStorestart = filterDropdownbyStoreStorestarts.value;
    var currentDate = new Date();
    // Get the current date
    var day = currentDate.getDate();
    var month = currentDate.getMonth() + 1; // Month is zero-based, so add 1
    var year = currentDate.getFullYear();

    // Format the date as needed
    var formattedDate = year + '-' + (month < 10 ? '0' : '') + month + '-' + (day < 10 ? '0' : '') + day;
    console.log('Date:')
    console.log(formattedDate)
    //const allStoresByStore=await fetchStores('all',selectedStorestart,'January_2024');
    const allStoresByStore='';

    const allStoresByStorescore=await fetchStoresScores('all',selectedStorestart,'February_2024');
    const allStoresbyscore = await allStoresByStorescore;
    creategaugeChartoutsidestorelevel(allStoresbyscore);
    creategaugeChartinsidestorelevel(allStoresbyscore);
    creategaugeChartmenustorelevel(allStoresbyscore);
    creategaugeChartmccafestorelevel(allStoresbyscore);
    creategaugeChartdrivethrustorelevel(allStoresbyscore)
    creategaugeChartdeliverystorelevel(allStoresbyscore)
    const allStoresby = await allStoresByStore;

    const allStores = await allStoresResponse;
    //const allStores ='';
    //createMapStore(allStoresby);
    
    const responseData2 = [
                // ... other store objects
                // Add central coordinates for provinces
                { "site_name": "Eastern Cape", "latitude": "-32.2968", "longitude": "26.4194", "region": "Eastern Cape","total":  "{{ num_EASTERN_CAPE_stores}}" },
                { "site_name": "Free State", "latitude": "-29.1211", "longitude": "26.2140", "region": "Free State","total":  "{{num_FREE_STATE_stores}}" },
                { "site_name": "Gauteng", "latitude": "-26.2708", "longitude": "28.1123", "region": "Gauteng","total":  "{{ num_gauteng_stores}}"},
                { "site_name": "KwaZulu-Natal", "latitude": "-29.8499", "longitude": "30.9668", "region": "KwaZulu-Natal","total":  "{{ num_KWAZULU_NATAL_stores}}" },
                { "site_name": "Limpopo", "latitude": "-23.4015", "longitude": "29.4185", "region": "Limpopo","total":  "{{ num_LIMPOPO_stores}}" },
                { "site_name": "Mpumalanga", "latitude": "-25.5653", "longitude": "30.5279", "region": "Mpumalanga","total":  "{{ num_MPUMALANGA_stores}}" },
                { "site_name": "North West", "latitude": "-25.6765", "longitude": "26.1182", "region": "North West","total":  "{{ num_NORTH_WEST_stores}}" },
                { "site_name": "Northern Cape", "latitude": "-29.0468", "longitude": "21.8569", "region": "Northern Cape","total":  "{{ num_NORTHERN_CAPE_stores}}" },
                { "site_name": "Western Cape", "latitude": "-33.9180", "longitude": "18.4233", "region": "Western Cape","total":  "{{ num_WESTERN_CAPE_stores}}" },
                
    ];
    createMapChart(responseData2);
    creategaugeChart(allStores);
    creategaugeChartinside(allStores);
    creategaugeChartMainDigitalMenu(allStores);
    creategaugeChartDrivethru(allStores);
    creategaugeChartMcCafMain(allStores);
    creategaugeChartDelivery(allStores);

    // Listen for changes in the dropdown selection
    
    


    
})();


$(document).ready(function () {
        // Handle navigation clicks
        $("header a").click(function (e) {
            e.preventDefault();
            var target = $(this).attr("href");
            $(".container").removeClass("active");
            $(target).addClass("active");
        });

    });
</script>
